#include "simple_mat.hh"
#include "testing.hh"

#include <iostream>

using std::cerr;
using std::endl;
using std::setw;

using Farsyte::Simple::Mat;
using Farsyte::Simple::Nr;
using Farsyte::Simple::Nc;

UT_CASE(Mat, InitCompare) {

    Mat const Zero;
    Mat const Unit{1};

    EXPECT_EQ(Zero, Zero);
    EXPECT_EQ(Unit, Unit);
    EXPECT_NE(Unit, Zero);
    EXPECT_NE(Zero, Unit);
};

UT_CASE(Mat, Access) {
    Mat const C{{9, 8, 7}, {6, 5, 4}, {3, 2, 1}};
    Mat M{{9, 6, 3}, {8, 5, 2}, {7, 4, 1}};
    EXPECT_EQ(M(0, 0), 9);
    EXPECT_EQ(M(1, 2), 2);
    M(2, 2) = 0;
    M(2, 1) = C(2, 2);
    EXPECT_EQ(M, (Mat{{9, 6, 3}, {8, 5, 2}, {7, 1, 0}}));
};

UT_CASE(Mat, Add) {
    Mat const I{{33, 42, 59}, {68, 56, 22}, {34, 12, 30}};
    Mat A{{3233, 2142, 4259}, {6804, 2256, 5622}, {3412, 1272, 3028}};

    EXPECT_EQ(I, (Mat{{33, 42, 59}, {68, 56, 22}, {34, 12, 30}}));
    EXPECT_EQ(A += I, (Mat{{3266, 2184, 4318}, {6872, 2312, 5644}, {3446, 1284, 3058}}));
    EXPECT_EQ(A, (Mat{{3266, 2184, 4318}, {6872, 2312, 5644}, {3446, 1284, 3058}}));
    EXPECT_EQ(A + I, (Mat{{3299, 2226, 4377}, {6940, 2368, 5666}, {3480, 1296, 3088}}));
    EXPECT_EQ(A + (-I), (Mat{{3233, 2142, 4259}, {6804, 2256, 5622}, {3412, 1272, 3028}}));
};

UT_CASE(Mat, Sub) {
    Mat const I{{33, 42, 59}, {68, 56, 22}, {34, 12, 30}};
    Mat A{{3299, 2226, 4377}, {6940, 2368, 5666}, {3480, 1296, 3088}};

    EXPECT_EQ(I, (Mat{{33, 42, 59}, {68, 56, 22}, {34, 12, 30}}));
    EXPECT_EQ(A -= I, (Mat{{3266, 2184, 4318}, {6872, 2312, 5644}, {3446, 1284, 3058}}));
    EXPECT_EQ(A, (Mat{{3266, 2184, 4318}, {6872, 2312, 5644}, {3446, 1284, 3058}}));
    EXPECT_EQ(A - I, (Mat{{3233, 2142, 4259}, {6804, 2256, 5622}, {3412, 1272, 3028}}));
    EXPECT_EQ(A - (-I), (Mat{{3299, 2226, 4377}, {6940, 2368, 5666}, {3480, 1296, 3088}}));
};

UT_CASE(Mat, Mul) {
    Mat i{{1, 0, 0}, {0, 1, 0}, {0, 0, 1}};
    Mat a{{12, 27, 49}, {59, 21, 50}, {18, 34, 55}};
    Mat b{{28, 16, 11}, {53, 37, 42}, {40, 31, 25}};

    EXPECT_EQ(i * i, (Mat{{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}));

    EXPECT_EQ(i * a, (Mat{{12, 27, 49}, {59, 21, 50}, {18, 34, 55}}));
    EXPECT_EQ(a * i, (Mat{{12, 27, 49}, {59, 21, 50}, {18, 34, 55}}));

    EXPECT_EQ(i * b, (Mat{{28, 16, 11}, {53, 37, 42}, {40, 31, 25}}));
    EXPECT_EQ(b * i, (Mat{{28, 16, 11}, {53, 37, 42}, {40, 31, 25}}));

    EXPECT_EQ(a * b, (Mat{{3727, 2710, 2491}, {4765, 3271, 2781}, {4506, 3251, 3001}}));
    EXPECT_EQ(b * a, (Mat{{1478, 1466, 2777}, {3575, 3636, 6757}, {2759, 2581, 4885}}));
};

UT_CASE(Mat, Scale) {
    Mat A{{3297, 2226, 4377}, {6930, 2364, 5664}, {3480, 1296, 3090}};
    Mat const C{{28, 42, 56}, {70, 56, 21}, {28, 14, 28}};

    EXPECT_EQ(A *= 2, (Mat{{6594, 4452, 8754}, {13860, 4728, 11328}, {6960, 2592, 6180}}));
    EXPECT_EQ(C * 2, (Mat{{56, 84, 112}, {140, 112, 42}, {56, 28, 56}}));
    EXPECT_EQ(3 * C, (Mat{{84, 126, 168}, {210, 168, 63}, {84, 42, 84}}));
    EXPECT_EQ(C / 7, (Mat{{4, 6, 8}, {10, 8, 3}, {4, 2, 4}}));
    EXPECT_EQ(A /= 3, (Mat{{2198, 1484, 2918}, {4620, 1576, 3776}, {2320, 864, 2060}}));
};
